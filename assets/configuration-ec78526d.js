import{m as _,a,s,F as n,n as L}from"./main-ef562b84.js";import{G as d,T as J,M as i,a as p,$ as e,c,A as B,t as w}from"./DarkTheme-2fd54461.js";const R={analyticsChanges:{}};R.initialize=function(S){const r=this;d.active_tab!="configuration"&&(d.active_tab="configuration",d.configuration_loaded=!0);function b(){_.loadSerialConfig(V)}function V(){Promise.resolve(!0).then(()=>i.promise(a.MSP_FEATURE_CONFIG)).then(()=>i.promise(a.MSP_BEEPER_CONFIG)).then(()=>i.promise(a.MSP_BOARD_ALIGNMENT_CONFIG)).then(()=>i.promise(a.MSP_ACC_TRIM)).then(()=>i.promise(a.MSP_ARMING_CONFIG)).then(()=>i.promise(a.MSP_RC_DEADBAND)).then(()=>i.promise(a.MSP_SENSOR_CONFIG)).then(()=>i.promise(a.MSP_SENSOR_ALIGNMENT)).then(()=>s.lt(n.CONFIG.apiVersion,p)?i.promise(a.MSP_NAME):Promise.resolve(!0)).then(()=>s.gte(n.CONFIG.apiVersion,p)?i.promise(a.MSP2_GET_TEXT,_.crunch(a.MSP2_GET_TEXT,a.CRAFT_NAME)):Promise.resolve(!0)).then(()=>i.promise(a.MSP_RX_CONFIG)).then(()=>s.gte(n.CONFIG.apiVersion,p)?i.promise(a.MSP2_GET_TEXT,_.crunch(a.MSP2_GET_TEXT,a.PILOT_NAME)):Promise.resolve(!0)).then(()=>i.promise(a.MSP_ADVANCED_CONFIG)).then(()=>U())}function U(){e("#content").load("./tabs/configuration.html",$)}b();function $(){r.analyticsChanges={};const O=e(".tab-configuration .features");n.FEATURE_CONFIG.features.generateElements(O);const H=e(".tab-configuration .dshotbeeper"),I=e("select.dshotBeeperBeaconTone"),y=e("tbody.dshotBeaconConditions"),X=e("tr.dshotBeaconSwitch");for(let t=1;t<=5;t++)I.append(`<option value="${t}">${t}</option>`);H.show(),I.change(function(){n.BEEPER_CONFIG.dshotBeaconTone=I.val()}),I.val(n.BEEPER_CONFIG.dshotBeaconTone);const v=e(".beepers .beeper-template");X.hide(),n.BEEPER_CONFIG.dshotBeaconConditions.generateElements(v,y),e("input.condition",y).change(function(){const t=e(this);n.BEEPER_CONFIG.dshotBeaconConditions.updateData(t)});const k=e(".beepers .beeper-configuration"),x=e(".tab-configuration .beepers");n.BEEPER_CONFIG.beepers.generateElements(v,k),c.localizePage();const l=["CW 0°","CW 90°","CW 180°","CW 270°","CW 0° flip","CW 90° flip","CW 180° flip","CW 270° flip","Custom"],D=e(".tab-configuration .gyro_align_content"),W=e(".tab-configuration .legacy_gyro_alignment"),z=e(".tab-configuration .legacy_accel_alignment"),C=e("select.gyroalign"),f=e("select.accalign"),T=e("select.magalign"),u=e("select.gyro_to_use"),A=e("select.gyro_1_align"),M=e("select.gyro_2_align");D.hide();for(let t=0;t<l.length;t++)C.append(`<option value="${t+1}">${l[t]}</option>`),f.append(`<option value="${t+1}">${l[t]}</option>`),T.append(`<option value="${t+1}">${l[t]}</option>`);C.val(n.SENSOR_ALIGNMENT.align_gyro),f.val(n.SENSOR_ALIGNMENT.align_acc),T.val(n.SENSOR_ALIGNMENT.align_mag),C.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.align_gyro&&(o=e(this).find("option:selected").text()),r.analyticsChanges.GyroAlignment=o,n.SENSOR_ALIGNMENT.align_gyro=t}),f.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.align_acc&&(o=e(this).find("option:selected").text()),r.analyticsChanges.AccAlignment=o,n.SENSOR_ALIGNMENT.align_acc=t}),T.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.align_mag&&(o=e(this).find("option:selected").text()),r.analyticsChanges.MagAlignment=o,n.SENSOR_ALIGNMENT.align_mag=t}),D.show(),W.hide(),z.hide();const F={DETECTED_GYRO_1:1,DETECTED_GYRO_2:2,DETECTED_DUAL_GYROS:128},m=(n.SENSOR_ALIGNMENT.gyro_detection_flags&F.DETECTED_GYRO_1)!=0,G=(n.SENSOR_ALIGNMENT.gyro_detection_flags&F.DETECTED_GYRO_2)!=0,Y=(n.SENSOR_ALIGNMENT.gyro_detection_flags&F.DETECTED_DUAL_GYROS)!=0;m&&u.append(`<option value="0">${c.getMessage("configurationSensorGyroToUseFirst")}</option>`),G&&u.append(`<option value="1">${c.getMessage("configurationSensorGyroToUseSecond")}</option>`),Y&&u.append(`<option value="2">${c.getMessage("configurationSensorGyroToUseBoth")}</option>`);for(let t=0;t<l.length;t++)A.append(`<option value="${t+1}">${l[t]}</option>`),M.append(`<option value="${t+1}">${l[t]}</option>`);u.val(n.SENSOR_ALIGNMENT.gyro_to_use),A.val(n.SENSOR_ALIGNMENT.gyro_1_align),M.val(n.SENSOR_ALIGNMENT.gyro_2_align),e(".gyro_alignment_inputs_first").toggle(m),e(".gyro_alignment_inputs_second").toggle(G),e(".gyro_alignment_inputs_selection").toggle(m||G),e(".gyro_alignment_inputs_notfound").toggle(!m&&!G),A.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.gyro_1_align&&(o=e(this).find("option:selected").text()),r.analyticsChanges.Gyro1Alignment=o,n.SENSOR_ALIGNMENT.gyro_1_align=t}),M.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.gyro_2_align&&(o=e(this).find("option:selected").text()),r.analyticsChanges.Gyro2Alignment=o,n.SENSOR_ALIGNMENT.gyro_2_align=t});const q=e("input.gyroFrequency"),h=e("select.gyroSyncDenom"),g=e("select.pidProcessDenom");function K(t,o,E){let N;E===0?N=c.getMessage("configurationSpeedPidNoGyro",{value:o}):N=c.getMessage("configurationKHzUnitLabel",{value:(E/o).toFixed(2)}),t.append(`<option value="${o}">${N}</option>`)}const j=function(t){h.hide();let o;t===0?o=c.getMessage("configurationSpeedGyroNoGyro"):o=c.getMessage("configurationKHzUnitLabel",{value:(t/1e3).toFixed(2)}),q.val(o)};e("div.gyroUse32kHz").hide(),j(n.CONFIG.sampleRateHz),h.val(n.PID_ADVANCED_CONFIG.gyro_sync_denom),e(".systemconfigNote").html(c.getMessage("configurationLoopTimeHelp")),h.change(function(){const t=parseInt(g.val()),o=n.CONFIG.sampleRateHz/1e3,E=8;g.empty();for(let N=1;N<=E;N++)K(g,N,o);g.val(t)}).change(),g.val(n.PID_ADVANCED_CONFIG.pid_process_denom),e('input[id="accHardwareSwitch"]').prop("checked",n.SENSOR_CONFIG.acc_hardware!==1),e('input[id="baroHardwareSwitch"]').prop("checked",n.SENSOR_CONFIG.baro_hardware!==1),e('input[id="magHardwareSwitch"]').prop("checked",n.SENSOR_CONFIG.mag_hardware!==1),s.gte(n.CONFIG.apiVersion,p)?(e('input[name="craftName"]').val(n.CONFIG.craftName),e('input[name="pilotName"]').val(n.CONFIG.pilotName)):(e('input[name="craftName"]').val(n.CONFIG.name),e(".pilotName").hide()),e('input[name="fpvCamAngleDegrees"]').val(n.RX_CONFIG.fpvCamAngleDegrees),e('input[name="board_align_roll"]').val(n.BOARD_ALIGNMENT_CONFIG.roll),e('input[name="board_align_pitch"]').val(n.BOARD_ALIGNMENT_CONFIG.pitch),e('input[name="board_align_yaw"]').val(n.BOARD_ALIGNMENT_CONFIG.yaw),e('input[name="roll"]').val(n.CONFIG.accelerometerTrims[1]),e('input[name="pitch"]').val(n.CONFIG.accelerometerTrims[0]),e('input[id="configurationSmallAngle"]').val(n.ARMING_CONFIG.small_angle),s.gte(n.CONFIG.apiVersion,B)?(e('input[id="configurationGyroCalOnFirstArm"]').prop("checked",n.ARMING_CONFIG.gyro_cal_on_first_arm===1),n.FEATURE_CONFIG.features.isEnabled("MOTOR_STOP")?e('input[id="configurationAutoDisarmDelay"]').val(n.ARMING_CONFIG.auto_disarm_delay):e('input[id="configurationAutoDisarmDelay"]').parent().hide()):(e('input[id="configurationGyroCalOnFirstArm"]').parent().parent().hide(),e('input[id="configurationAutoDisarmDelay"]').parent().parent().hide());function P(){n.FEATURE_CONFIG.features.isEnabled("GPS")?e(".gpsSettings").show():e(".gpsSettings").hide()}e("input.feature",O).change(function(){const t=e(this);n.FEATURE_CONFIG.features.updateData(t),L(n.FEATURE_CONFIG.features),t.attr("name")==="GPS"&&P()}),e('input[id="accHardwareSwitch"]').change(function(){const t=e(this).is(":checked");e(".accelNeeded").toggle(t)}).change(),e(O).filter("select").change(function(){const t=e(this);n.FEATURE_CONFIG.features.updateData(t),L(n.FEATURE_CONFIG.features)}),e("input.condition",x).change(function(){const t=e(this);n.BEEPER_CONFIG.beepers.updateData(t)}),P(),e("a.save").on("click",function(){n.BOARD_ALIGNMENT_CONFIG.roll=parseInt(e('input[name="board_align_roll"]').val()),n.BOARD_ALIGNMENT_CONFIG.pitch=parseInt(e('input[name="board_align_pitch"]').val()),n.BOARD_ALIGNMENT_CONFIG.yaw=parseInt(e('input[name="board_align_yaw"]').val()),n.CONFIG.accelerometerTrims[1]=parseInt(e('input[name="roll"]').val()),n.CONFIG.accelerometerTrims[0]=parseInt(e('input[name="pitch"]').val()),s.gte(n.CONFIG.apiVersion,B)&&(n.ARMING_CONFIG.gyro_cal_on_first_arm=e('input[id="configurationGyroCalOnFirstArm"]').is(":checked")?1:0,n.FEATURE_CONFIG.features.isEnabled("MOTOR_STOP")&&(n.ARMING_CONFIG.auto_disarm_delay=parseInt(e('input[id="configurationAutoDisarmDelay"]').val()))),n.ARMING_CONFIG.small_angle=parseInt(e('input[id="configurationSmallAngle"]').val()),n.SENSOR_ALIGNMENT.gyro_to_use=parseInt(u.val()),n.PID_ADVANCED_CONFIG.gyro_sync_denom=parseInt(h.val());const t=parseInt(g.val());if(t!==n.PID_ADVANCED_CONFIG.pid_process_denom){const E=g.find("option:selected").text();r.analyticsChanges.PIDLoopSettings=`denominator: ${t} | frequency: ${E}`}else r.analyticsChanges.PIDLoopSettings=void 0;n.PID_ADVANCED_CONFIG.pid_process_denom=t,n.RX_CONFIG.fpvCamAngleDegrees=parseInt(e('input[name="fpvCamAngleDegrees"]').val()),w.sendSaveAndChangeEvents(w.EVENT_CATEGORIES.FLIGHT_CONTROLLER,r.analyticsChanges,"configuration"),r.analyticsChanges={},n.SENSOR_CONFIG.acc_hardware=e('input[id="accHardwareSwitch"]').is(":checked")?0:1,n.SENSOR_CONFIG.baro_hardware=e('input[id="baroHardwareSwitch"]').is(":checked")?0:1,n.SENSOR_CONFIG.mag_hardware=e('input[id="magHardwareSwitch"]').is(":checked")?0:1,s.gte(n.CONFIG.apiVersion,p)?(n.CONFIG.craftName=e('input[name="craftName"]').val().trim(),n.CONFIG.pilotName=e('input[name="pilotName"]').val().trim()):n.CONFIG.name=e('input[name="craftName"]').val().trim();function o(){Promise.resolve(!0).then(()=>i.promise(a.MSP_SET_FEATURE_CONFIG,_.crunch(a.MSP_SET_FEATURE_CONFIG))).then(()=>i.promise(a.MSP_SET_BEEPER_CONFIG,_.crunch(a.MSP_SET_BEEPER_CONFIG))).then(()=>i.promise(a.MSP_SET_BOARD_ALIGNMENT_CONFIG,_.crunch(a.MSP_SET_BOARD_ALIGNMENT_CONFIG))).then(()=>i.promise(a.MSP_SET_RC_DEADBAND,_.crunch(a.MSP_SET_RC_DEADBAND))).then(()=>i.promise(a.MSP_SET_SENSOR_ALIGNMENT,_.crunch(a.MSP_SET_SENSOR_ALIGNMENT))).then(()=>i.promise(a.MSP_SET_ADVANCED_CONFIG,_.crunch(a.MSP_SET_ADVANCED_CONFIG))).then(()=>i.promise(a.MSP_SET_ACC_TRIM,_.crunch(a.MSP_SET_ACC_TRIM))).then(()=>i.promise(a.MSP_SET_ARMING_CONFIG,_.crunch(a.MSP_SET_ARMING_CONFIG))).then(()=>i.promise(a.MSP_SET_SENSOR_CONFIG,_.crunch(a.MSP_SET_SENSOR_CONFIG))).then(()=>s.gte(n.CONFIG.apiVersion,p)?i.promise(a.MSP2_SET_TEXT,_.crunch(a.MSP2_SET_TEXT,a.CRAFT_NAME)):i.promise(a.MSP_SET_NAME,_.crunch(a.MSP_SET_NAME))).then(()=>s.gte(n.CONFIG.apiVersion,p)?i.promise(a.MSP2_SET_TEXT,_.crunch(a.MSP2_SET_TEXT,a.PILOT_NAME)):Promise.resolve(!0)).then(()=>i.promise(a.MSP_SET_RX_CONFIG,_.crunch(a.MSP_SET_RX_CONFIG))).then(()=>_.writeConfiguration(!0))}_.sendSerialConfig(o)}),d.interval_add("status_pull",function(){i.send_message(a.MSP_STATUS)},250,!0),d.content_ready(S)}};R.cleanup=function(S){S&&S()};J.configuration=R;export{R as configuration};
