import{G as o,M as d,$ as e,T as w,c as i,b as A,A as C,a as B}from"./DarkTheme-2fd54461.js";import{a as r,F as t,j as se,k as c,l as ne,m as D,s as S}from"./main-ef562b84.js";const f={yaw_fix:0};f.initialize=function(g){const l=this;o.active_tab!="setup"&&(o.active_tab="setup");function I(){d.send_message(r.MSP_STATUS_EX,!1,!1,L)}function L(){d.send_message(r.MSP_MIXER_CONFIG,!1,!1,P)}function P(){e("#content").load("./tabs/setup.html",v)}d.send_message(r.MSP_ACC_TRIM,!1,!1,I);function v(){i.localizePage(),l.initModel(),e("span.roll").text(i.getMessage("initialSetupAttitude",[0])),e("span.pitch").text(i.getMessage("initialSetupAttitude",[0])),e("span.heading").text(i.getMessage("initialSetupAttitude",[0])),c(t.CONFIG.activeSensors,"acc")||(e("a.calibrateAccel").addClass("disabled"),e("default_btn").addClass("disabled")),c(t.CONFIG.activeSensors,"mag")||(e("a.calibrateMag").addClass("disabled"),e("default_btn").addClass("disabled")),l.initializeInstruments(),e("#arming-disable-flag").attr("title",i.getMessage("initialSetupArmingDisableFlagsTooltip")),ne()?e(".initialSetupRebootBootloader").show():e(".initialSetupRebootBootloader").hide(),e("a.rebootBootloader").click(function(){const s=[];s.push(t.boardHasFlashBootloader()?D.REBOOT_TYPES.BOOTLOADER_FLASH:D.REBOOT_TYPES.BOOTLOADER),d.send_message(r.MSP_SET_REBOOT,s,!1)}),e("a.calibrateAccel").click(function(){const s=e(this);s.hasClass("calibrating")||(s.addClass("calibrating"),o.interval_pause("setup_data_pull"),d.send_message(r.MSP_ACC_CALIBRATION,!1,!1,function(){A(i.getMessage("initialSetupAccelCalibStarted")),e("#accel_calib_running").show(),e("#accel_calib_rest").hide()}),o.timeout_add("button_reset",function(){o.interval_resume("setup_data_pull"),A(i.getMessage("initialSetupAccelCalibEnded")),s.removeClass("calibrating"),e("#accel_calib_running").hide(),e("#accel_calib_rest").show()},2e3))}),e("a.calibrateMag").click(function(){const s=e(this);if(!s.hasClass("calibrating")&&!s.hasClass("disabled")){let a=function(){A(i.getMessage("initialSetupMagCalibEnded")),s.removeClass("calibrating"),e("#mag_calib_running").hide(),e("#mag_calib_rest").show()};if(s.addClass("calibrating"),d.send_message(r.MSP_MAG_CALIBRATION,!1,!1,function(){A(i.getMessage("initialSetupMagCalibStarted")),e("#mag_calib_running").show(),e("#mag_calib_rest").hide()}),S.gte(t.CONFIG.apiVersion,C)){let n=0;const _=45,p=setInterval(function(){(n>=_||!(t.CONFIG.armingDisableFlags&4096))&&(clearInterval(p),a()),n++},1e3)}else o.timeout_add("button_reset",a,3e4)}});const M=e(".dialogConfirmReset")[0];e("a.resetSettings").click(function(){M.showModal()}),e(".dialogConfirmReset-cancelbtn").click(function(){M.close()}),e(".dialogConfirmReset-confirmbtn").click(function(){M.close(),d.send_message(r.MSP_RESET_CONF,!1,!1,function(){A(i.getMessage("initialSetupSettingsRestored")),o.tab_switch_cleanup(function(){w.setup.initialize()})})}),e("div#interactive_block > a.reset").text(i.getMessage("initialSetupButtonResetZaxisValue",[l.yaw_fix])),e("div#interactive_block > a.reset").click(function(){l.yaw_fix=t.SENSOR_DATA.kinematics[2]*-1,e(this).text(i.getMessage("initialSetupButtonResetZaxisValue",[l.yaw_fix])),console.log(`YAW reset to 0 deg, fix: ${l.yaw_fix} deg`)});const y=e(".bat-voltage"),$=e(".bat-mah-drawn"),V=e(".bat-mah-drawing"),U=e(".rssi"),G=e(".cpu-temp"),m=e(".arming-disable-flags"),x=e(".GPS_info span.colorToggle"),k=e(".gpsSats"),H=e("dd.roll"),z=e("dd.pitch"),K=e("dd.heading"),X=e(".sonarAltitude"),b=e(".sensor_gyro_hw"),N=e(".sensor_acc_hw"),h=e(".sensor_mag_hw"),F=e(".sensor_baro_hw"),E=e(".sensor_sonar_hw"),Y=e(".api-version"),W=e(".build-date"),j=e(".build-type"),T=e(".build-info"),R=e(".build-options"),Q=function(){let s=["NO_GYRO","FAILSAFE","RX_FAILSAFE","NOT_DISARMED","BOXFAILSAFE","RUNAWAY_TAKEOFF","CRASH_DETECTED","THROTTLE","ANGLE","BOOT_GRACE_TIME","NOPREARM","LOAD","CALIBRATING","CLI","CMS_MENU","BST","MSP","PARALYZE","GPS","RESC","RPMFILTER","REBOOT_REQUIRED","DSHOT_BITBANG","ACC_CALIBRATION","MOTOR_PROTOCOL"];S.gte(t.CONFIG.apiVersion,C)&&s.splice(s.indexOf("RPMFILTER"),1,"DSHOT_TELEM"),m.append('<span id="initialSetupArmingAllowed" i18n="initialSetupArmingAllowed" style="display: none;"></span>');for(let a=0;a<t.CONFIG.armingDisableCount;a++)if(a<s.length-1){const n=`initialSetupArmingDisableFlagsTooltip${s[a]}`;m.append(`<span id="initialSetupArmingDisableFlags${a}" class="cf_tip disarm-flag" title="${i.getMessage(n)}" style="display: none;">${s[a]}</span>`)}else a==t.CONFIG.armingDisableCount-1?m.append(`<span id="initialSetupArmingDisableFlags${a}" class="cf_tip disarm-flag" title="${i.getMessage("initialSetupArmingDisableFlagsTooltipARM_SWITCH")}" style="display: none;">ARM_SWITCH</span>`):m.append(`<span id="initialSetupArmingDisableFlags${a}" class="disarm-flag" style="display: none;">${a+1}</span>`)},Z=function(){const s=["NONE","DEFAULT","MPU6050","L3G4200D","MPU3050","L3GD20","MPU6000","MPU6500","MPU9250","ICM20601","ICM20602","ICM20608G","ICM20649","ICM20689","ICM42605","ICM42688P","BMI160","BMI270","LSM6DSO","LSM6DSV16X","VIRTUAL"],a=["DEFAULT","NONE","ADXL345","MPU6050","MMA8452","BMA280","LSM303DLHC","MPU6000","MPU6500","MPU9250","ICM20601","ICM20602","ICM20608G","ICM20649","ICM20689","ICM42605","ICM42688P","BMI160","BMI270","LSM6DSO","LSM6DSV16X","VIRTUAL"],n=["DEFAULT","NONE","HMC5883","AK8975","AK8963","QMC5883","LIS2MDL","LIS3MDL","MPU925X_AK8963","IST8310"],_=["DEFAULT","NONE","BMP085","MS5611","BMP280","LPS","QMP6988","BMP388","DPS310","2SMPB_02B","VIRTUAL"],u=["NONE","HCSR04","TFMINI","TF02"];S.gte(t.CONFIG.apiVersion,C)&&d.send_message(r.MSP2_SENSOR_CONFIG_ACTIVE,!1,!1,function(){const p=i.getMessage("initialSetupNotInBuild"),O=i.getMessage("initialSetupNotDetected");t.SENSOR_CONFIG_ACTIVE.gyro_hardware==255?b.text(p):c(t.CONFIG.activeSensors,"gyro")&&t.SENSOR_CONFIG_ACTIVE.gyro_hardware>1?b.text(s[t.SENSOR_CONFIG_ACTIVE.gyro_hardware]):b.text(O),t.SENSOR_CONFIG_ACTIVE.acc_hardware==255?N.text(p):c(t.CONFIG.activeSensors,"acc")&&t.SENSOR_CONFIG_ACTIVE.acc_hardware>1?N.text(a[t.SENSOR_CONFIG_ACTIVE.acc_hardware]):N.text(O),t.SENSOR_CONFIG_ACTIVE.baro_hardware==255?F.text(p):c(t.CONFIG.activeSensors,"baro")&&t.SENSOR_CONFIG_ACTIVE.baro_hardware>1?F.text(_[t.SENSOR_CONFIG_ACTIVE.baro_hardware]):F.text(O),t.SENSOR_CONFIG_ACTIVE.mag_hardware==255?h.text(p):c(t.CONFIG.activeSensors,"mag")&&t.SENSOR_CONFIG_ACTIVE.mag_hardware>1?h.text(n[t.SENSOR_CONFIG_ACTIVE.mag_hardware]):h.text(O),t.SENSOR_CONFIG_ACTIVE.sonar_hardware==255?E.text(p):c(t.CONFIG.activeSensors,"sonar")&&t.SENSOR_CONFIG_ACTIVE.sonar_hardware>0?E.text(u[t.SENSOR_CONFIG_ACTIVE.sonar_hardware]):E.text(O)})};function q(s,a){const n=e(".dialogBuildInfo")[0];e(".dialogBuildInfo-title").html(s),e(".dialogBuildInfo-content").html(a),n.hasAttribute("open")||(n.showModal(),e(".dialogBuildInfo-closebtn").on("click",function(){n.close()}))}const J=function(){const s=t.CONFIG.buildKey.length===32;if(s&&navigator.onLine){const a=`https://build.betaflight.com/api/builds/${t.CONFIG.buildKey}`,n=`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildConfig")}: ${a}/json">
                                    <a href="${a}/json" target="_blank"><strong>${i.getMessage("initialSetupInfoBuildConfig")}</strong></a></span>`,_=`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildLog")}: ${a}/log">
                                    <a href="${a}/log" target="_blank"><strong>${i.getMessage("initialSetupInfoBuildLog")}</strong></a></span>`;T.html(`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildOptions")}">
                    <a class="buildOptions" href=#"><strong>${i.getMessage("initialSetupInfoBuildOptionList")}</strong></a></span>`),T.html(`${n} ${_}`)}else T.html(s?i.getMessage("initialSetupNotOnline"):i.getMessage("initialSetupNoBuildInfo"))},ee=function(){if((S.eq(t.CONFIG.apiVersion,B)&&navigator.onLine||S.gte(t.CONFIG.apiVersion,C))&&t.CONFIG.buildOptions.length){let a='<div class="dialogBuildInfoGrid-container">';for(const _ of t.CONFIG.buildOptions)a+=`<div class="dialogBuildInfoGrid-item">${_}</div>`;a+="</div>",R.html(`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildOptions")}">
                    <a class="buildOptions" href=#"><strong>${i.getMessage("initialSetupInfoBuildOptionList")}</strong></a></span>`);const n=`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildOptionList")}">
                                      <a class="buildOptions" href=#"><strong>${i.getMessage("initialSetupInfoBuildOptions")}</strong></a></span>`;R.html(n),e("a.buildOptions").on("click",async function(){q(`<h3>${i.getMessage("initialSetupInfoBuildOptionList")}</h3>`,a)})}else R.html(`${i.getMessage("initialSetupNoBuildInfo")}`)};function te(){Y.text(t.CONFIG.apiVersion),W.text(t.CONFIG.buildInfo),S.gte(t.CONFIG.apiVersion,B)&&(j.html(t.CONFIG.buildKey.length===32?i.getMessage("initialSetupInfoBuildCloud"):i.getMessage("initialSetupInfoBuildLocal")),J(),ee())}Q(),Z(),te(),c(t.CONFIG.activeSensors,"sonar")||e(".sonarBox").hide();function ie(){e("#initialSetupArmingAllowed").toggle(t.CONFIG.armingDisableFlags===0);for(let u=0;u<t.CONFIG.armingDisableCount;u++)e(`#initialSetupArmingDisableFlags${u}`).css("display",t.CONFIG.armingDisableFlags&1<<u?"inline-block":"none");y.text(i.getMessage("initialSetupBatteryValue",[t.ANALOG.voltage])),$.text(i.getMessage("initialSetupBatteryMahValue",[t.ANALOG.mAhdrawn])),V.text(i.getMessage("initialSetupBatteryAValue",[t.ANALOG.amperage.toFixed(2)])),U.text(i.getMessage("initialSetupRSSIValue",[(t.ANALOG.rssi/1023*100).toFixed(0)])),S.gte(t.CONFIG.apiVersion,C)&&t.CONFIG.cpuTemp?G.html(`${t.CONFIG.cpuTemp.toFixed(0)} &#8451;`):G.text(i.getMessage("initialSetupCpuTempNotSupported")),x.text(t.GPS_DATA.fix?i.getMessage("gpsFixTrue"):i.getMessage("gpsFixFalse")),x.toggleClass("ready",t.GPS_DATA.fix!=0),k.text(t.GPS_DATA.numSat);const s=t.GPS_DATA.lat/1e7,a=t.GPS_DATA.lon/1e7,n=`https://maps.google.com/?q=${s},${a}`,_=i.getMessage("gpsPositionUnit");e(".GPS_info td.latLon a").prop("href",n).text(`${s.toFixed(4)} / ${a.toFixed(4)} ${_}`)}function ae(){d.send_message(r.MSP_ATTITUDE,!1,!1,function(){H.text(i.getMessage("initialSetupAttitude",[t.SENSOR_DATA.kinematics[0]])),z.text(i.getMessage("initialSetupAttitude",[t.SENSOR_DATA.kinematics[1]])),K.text(i.getMessage("initialSetupAttitude",[t.SENSOR_DATA.kinematics[2]])),l.renderModel(),l.updateInstruments()}),c(t.CONFIG.activeSensors,"sonar")&&d.send_message(r.MSP_SONAR,!1,!1,function(){X.text(`${t.SENSOR_DATA.sonar.toFixed(1)} cm`)})}o.interval_add("setup_data_pull_fast",ae,33,!0),o.interval_add("setup_data_pull_slow",ie,250,!0),o.content_ready(g)}};f.initializeInstruments=function(){const g={size:90,showBox:!1,img_directory:"images/flightindicators/"},l=e.flightIndicator("#attitude","attitude",g),I=e.flightIndicator("#heading","heading",g);this.updateInstruments=function(){l.setRoll(t.SENSOR_DATA.kinematics[0]),l.setPitch(t.SENSOR_DATA.kinematics[1]),I.setHeading(t.SENSOR_DATA.kinematics[2])}};f.initModel=function(){this.model=new se(e(".model-and-info #canvas_wrapper"),e(".model-and-info #canvas")),e(window).on("resize",e.proxy(this.model.resize,this.model))};f.renderModel=function(){const g=t.SENSOR_DATA.kinematics[1]*-1*.017453292519943295,l=(t.SENSOR_DATA.kinematics[2]*-1-this.yaw_fix)*.017453292519943295,I=t.SENSOR_DATA.kinematics[0]*-1*.017453292519943295;this.model.rotateTo(g,l,I)};f.cleanup=function(g){this.model&&(e(window).off("resize",e.proxy(this.model.resize,this.model)),this.model.dispose()),g&&g()};w.setup=f;export{f as setup};
