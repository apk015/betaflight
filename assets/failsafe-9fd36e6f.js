import{G as E,T as j,M as n,A as S,$ as e,c as i,a as K}from"./DarkTheme-2fd54461.js";import{a as s,m as c,s as d,F as a}from"./main-ef562b84.js";import{a as Y}from"./peripherals-40b4a0c5.js";const C={};C.initialize=function(p){E.active_tab!="failsafe"&&(E.active_tab="failsafe");function A(){n.send_message(s.MSP_RX_CONFIG,!1,!1,x)}function x(){n.send_message(s.MSP_FAILSAFE_CONFIG,!1,!1,M)}function M(){n.send_message(s.MSP_RXFAIL_CONFIG,!1,!1,P)}function P(){n.send_message(s.MSP_GPS_RESCUE,!1,!1,O)}function O(){n.send_message(s.MSP_BOXNAMES,!1,!1,N)}function N(){n.send_message(s.MSP_MODE_RANGES,!1,!1,U)}function U(){n.send_message(s.MSP_BOXIDS,!1,!1,b)}function b(){c.loadSerialConfig(y)}function y(){n.send_message(s.MSP_RC,!1,!1,L)}function L(){n.send_message(s.MSP_RSSI_CONFIG,!1,!1,k)}function k(){n.send_message(s.MSP_FEATURE_CONFIG,!1,!1,w)}function w(){n.send_message(s.MSP_MOTOR_CONFIG,!1,!1,X)}function X(){d.gte(a.CONFIG.apiVersion,S)?n.send_message(s.MSP_COMPASS_CONFIG,!1,!1,I):I()}function I(){n.send_message(s.MSP_GPS_CONFIG,!1,!1,T)}function T(){e("#content").load("./tabs/failsafe.html",$)}A();function $(){function V(t){t?e("div.stage2").show():e("div.stage2").hide()}const G=e("div.oldpane");G.prop("disabled",!0),G.hide();const f=[];for(let t=0;t<a.RC.active_channels-4;t++)f.push("");typeof a.RSSI_CONFIG.channel<"u"&&(f[a.RSSI_CONFIG.channel-5]+='<span class="modename">RSSI</span>');let F=!1;for(let t=0;t<a.AUX_CONFIG.length;t++){const _=a.AUX_CONFIG_IDS[t];for(let u=0;u<a.MODE_RANGES.length;u++){const o=a.MODE_RANGES[u];if(o.id!=_)continue;const R=o.range;if(R.start>=R.end)continue;let g=a.AUX_CONFIG[t];!F&&g==="GPS RESCUE"&&(F=!0),g=Y(_,g),f[o.auxChannelIndex]+=`<span class="modename">${g}</span>`}}const v=[i.getMessage("controlAxisRoll"),i.getMessage("controlAxisPitch"),i.getMessage("controlAxisYaw"),i.getMessage("controlAxisThrottle")],m=e("div.activechannellist");let D=1,H=0;for(let t=0;t<a.RXFAIL_CONFIG.length;t++)if(t<v.length)m.append(`                    <div class="number">                        <div class="channelprimary">                            <span>${v[t]}</span>                        </div>                        <div class="cf_tip channelsetting" title="${i.getMessage("failsafeChannelFallbackSettingsAuto")}">                            <select class="aux_set" id="${t}">                                <option value="0">${i.getMessage("failsafeChannelFallbackSettingsValueAuto")}</option>                                <option value="1">${i.getMessage("failsafeChannelFallbackSettingsValueHold")}</option>                                <option value="2">${i.getMessage("failsafeChannelFallbackSettingsValueSet")}</option>                            </select>                        </div>                        <div class="auxiliary"><input type="number" name="aux_value" min="750" max="2250" step="25" id="${t}"/></div>                    </div>                `);else{const _=`controlAxisAux${D++}`;m.append(`                    <div class="number">                        <div class="channelauxiliary">                            <span class="channelname">${i.getMessage(_)}</span>                            ${f[H++]}                        </div>                        <div class="cf_tip channelsetting" title="${i.getMessage("failsafeChannelFallbackSettingsHold")}">                            <select class="aux_set" id="${t}">                                <option value="1">${i.getMessage("failsafeChannelFallbackSettingsValueHold")}</option>                                <option value="2">${i.getMessage("failsafeChannelFallbackSettingsValueSet")}</option>                            </select>                        </div>                        <div class="auxiliary"><input type="number" name="aux_value" min="750" max="2250" step="25" id="${t}"/></div>                    </div>                `)}const h=[];e(".number",m).each(function(){h.push(e("select.aux_set",this))});const r=[];e(".number",m).each(function(){r.push(e('input[name="aux_value"]',this))});const B=e("select.aux_set"),W=e('input[name="aux_value"]');B.change(function(){const t=parseInt(e(this).val()),_=parseInt(e(this).prop("id"));a.RXFAIL_CONFIG[_].mode=t,t==2?(r[_].prop("disabled",!1),r[_].show()):(r[_].prop("disabled",!0),r[_].hide())}),W.change(function(){const t=parseInt(e(this).prop("id"));a.RXFAIL_CONFIG[t].value=parseInt(e(this).val())}),e('input[name="rx_min_usec"]').val(a.RX_CONFIG.rx_min_usec),e('input[name="rx_max_usec"]').val(a.RX_CONFIG.rx_max_usec);for(let t=0;t<a.RXFAIL_CONFIG.length;t++)r[t].val(a.RXFAIL_CONFIG[t].value),h[t].val(a.RXFAIL_CONFIG[t].mode),h[t].change();a.FEATURE_CONFIG.features.generateElements(e(".tab-failsafe .featuresNew")),e("tbody.rxFailsafe").hide(),V(!0),e('input[name="failsafe_throttle"]').val(a.FAILSAFE_CONFIG.failsafe_throttle),e('input[name="failsafe_off_delay"]').val((a.FAILSAFE_CONFIG.failsafe_off_delay/10).toFixed(1)),e('input[name="failsafe_throttle_low_delay"]').val((a.FAILSAFE_CONFIG.failsafe_throttle_low_delay/10).toFixed(1)),e('input[name="failsafe_delay"]').val((a.FAILSAFE_CONFIG.failsafe_delay/10).toFixed(1));const z=e('input[id="gps_rescue"]').parent().parent().find(":input");e('input[type="radio"].procedure').on("change",function(){e(".proceduresettings :input").attr("disabled",!0),e(this).parent().parent().find(":input").attr("disabled",!1),F&&z.attr("disabled",!1)});let l;switch(a.FAILSAFE_CONFIG.failsafe_procedure){case 0:l=e('input[id="land"]'),l.prop("checked",!0),l.trigger("change");break;case 1:l=e('input[id="drop"]'),l.prop("checked",!0),l.trigger("change");break;case 2:l=e('input[id="gps_rescue"]'),l.prop("checked",!0),l.trigger("change");break}e("#failsafeSwitchSelect").sortSelect(i.getMessage("failsafeSwitchOptionStage1")),e('select[name="failsafe_switch_mode"]').val(a.FAILSAFE_CONFIG.failsafe_switch_mode),e("div.kill_switch").hide(),e('input[name="gps_rescue_angle"]').val(a.GPS_RESCUE.angle),e('input[name="gps_rescue_return_altitude"]').val(a.GPS_RESCUE.returnAltitudeM),e('input[name="gps_rescue_descent_distance"]').val(a.GPS_RESCUE.descentDistanceM),e('input[name="gps_rescue_ground_speed"]').val((a.GPS_RESCUE.groundSpeed/100).toFixed(1)),e('input[name="gps_rescue_throttle_min"]').val(a.GPS_RESCUE.throttleMin),e('input[name="gps_rescue_throttle_max"]').val(a.GPS_RESCUE.throttleMax),e('input[name="gps_rescue_throttle_hover"]').val(a.GPS_RESCUE.throttleHover),e('input[name="gps_rescue_min_sats"]').val(a.GPS_RESCUE.minSats),e("#failsafeGpsRescueItemSanitySelect").sortSelect(),e('select[name="gps_rescue_sanity_checks"]').val(a.GPS_RESCUE.sanityChecks),e("#failsafeGpsRescueItemAltitudeSelect").sortSelect(),e('input[name="gps_rescue_ascend_rate"]').val((a.GPS_RESCUE.ascendRate/100).toFixed(1)),e('input[name="gps_rescue_descend_rate"]').val((a.GPS_RESCUE.descendRate/100).toFixed(1)),e('input[name="gps_rescue_allow_arming_without_fix"]').prop("checked",a.GPS_RESCUE.allowArmingWithoutFix>0),e('select[name="gps_rescue_altitude_mode"]').val(a.GPS_RESCUE.altitudeMode),e('input[name="gps_rescue_min_start_dist"]').val(a.GPS_RESCUE.minStartDistM),d.gte(a.CONFIG.apiVersion,K)&&(e('input[name="gps_rescue_angle"]').attr("max",80),e('input[name="gps_rescue_return_altitude"]').attr({min:2,max:255}),e('input[name="gps_rescue_descent_distance"]').attr("min",5),e('input[name="gps_rescue_min_start_dist"]').attr("min",20),e('input[name="gps_rescue_ground_speed"]').attr("min",0),e('input[name="gps_rescue_ascend_rate"]').attr("min",.5),e('input[name="gps_rescue_descend_rate"]').attr("min",.3)),d.gte(a.CONFIG.apiVersion,S)?e('input[name="gps_rescue_initial_climb"]').val(a.GPS_RESCUE.initialClimbM):e('input[name="gps_rescue_initial_climb"]').closest(".number").hide(),d.gte(a.CONFIG.apiVersion,S)&&(e('input[name="gps_rescue_angle"]').attr({min:30,max:60}),e('input[name="gps_rescue_return_altitude"]').attr({min:5,max:1e3}),e('input[name="gps_rescue_descent_distance"]').attr("min",10),e('input[name="gps_rescue_min_start_dist"]').attr({min:10,max:30}).closest(".number").children(".helpicon").attr("i18n_title","failsafeGpsRescueItemMinStartDistHelp"),e('input[name="gps_rescue_descend_rate"]').attr({min:.2,max:50})),e("a.save").click(function(){a.FEATURE_CONFIG.features.updateData(e('input[name="FAILSAFE"]')),a.RX_CONFIG.rx_min_usec=parseInt(e('input[name="rx_min_usec"]').val()),a.RX_CONFIG.rx_max_usec=parseInt(e('input[name="rx_max_usec"]').val()),a.FAILSAFE_CONFIG.failsafe_throttle=parseInt(e('input[name="failsafe_throttle"]').val()),a.FAILSAFE_CONFIG.failsafe_off_delay=Math.round(10*parseFloat(e('input[name="failsafe_off_delay"]').val())),a.FAILSAFE_CONFIG.failsafe_throttle_low_delay=Math.round(10*parseFloat(e('input[name="failsafe_throttle_low_delay"]').val())),a.FAILSAFE_CONFIG.failsafe_delay=Math.round(10*parseFloat(e('input[name="failsafe_delay"]').val())),e('input[id="land"]').is(":checked")?a.FAILSAFE_CONFIG.failsafe_procedure=0:e('input[id="drop"]').is(":checked")?a.FAILSAFE_CONFIG.failsafe_procedure=1:e('input[id="gps_rescue"]').is(":checked")&&(a.FAILSAFE_CONFIG.failsafe_procedure=2),a.FAILSAFE_CONFIG.failsafe_switch_mode=e('select[name="failsafe_switch_mode"]').val(),a.GPS_RESCUE.angle=e('input[name="gps_rescue_angle"]').val(),a.GPS_RESCUE.returnAltitudeM=e('input[name="gps_rescue_return_altitude"]').val(),a.GPS_RESCUE.descentDistanceM=e('input[name="gps_rescue_descent_distance"]').val(),a.GPS_RESCUE.groundSpeed=e('input[name="gps_rescue_ground_speed"]').val()*100,a.GPS_RESCUE.throttleMin=e('input[name="gps_rescue_throttle_min"]').val(),a.GPS_RESCUE.throttleMax=e('input[name="gps_rescue_throttle_max"]').val(),a.GPS_RESCUE.throttleHover=e('input[name="gps_rescue_throttle_hover"]').val(),a.GPS_RESCUE.minSats=e('input[name="gps_rescue_min_sats"]').val(),a.GPS_RESCUE.sanityChecks=e('select[name="gps_rescue_sanity_checks"]').val(),a.GPS_RESCUE.ascendRate=e('input[name="gps_rescue_ascend_rate"]').val()*100,a.GPS_RESCUE.descendRate=e('input[name="gps_rescue_descend_rate"]').val()*100,a.GPS_RESCUE.allowArmingWithoutFix=e('input[name="gps_rescue_allow_arming_without_fix"]').prop("checked")?1:0,a.GPS_RESCUE.altitudeMode=parseInt(e('select[name="gps_rescue_altitude_mode"]').val()),a.GPS_RESCUE.minStartDistM=e('input[name="gps_rescue_min_start_dist"]').val(),d.gte(a.CONFIG.apiVersion,S)&&(a.GPS_RESCUE.initialClimbM=e('input[name="gps_rescue_initial_climb"]').val());function t(){n.send_message(s.MSP_SET_FAILSAFE_CONFIG,c.crunch(s.MSP_SET_FAILSAFE_CONFIG),!1,_)}function _(){c.sendRxFailConfig(u)}function u(){n.send_message(s.MSP_SET_FEATURE_CONFIG,c.crunch(s.MSP_SET_FEATURE_CONFIG),!1,o)}function o(){n.send_message(s.MSP_SET_GPS_RESCUE,c.crunch(s.MSP_SET_GPS_RESCUE),!1,c.writeConfiguration(!0))}n.send_message(s.MSP_SET_RX_CONFIG,c.crunch(s.MSP_SET_RX_CONFIG),!1,t)}),i.localizePage(),E.content_ready(p)}};C.cleanup=function(p){p&&p()};j.failsafe=C;export{C as failsafe};
